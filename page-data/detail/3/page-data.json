{"componentChunkName":"component---src-templates-detail-js","path":"/detail/3","result":{"data":{"markdownRemark":{"html":"<h2 id=\"react-离开页面时-axios-取消之前还未返回的请求\" style=\"position:relative;\"><a href=\"#react-%E7%A6%BB%E5%BC%80%E9%A1%B5%E9%9D%A2%E6%97%B6-axios-%E5%8F%96%E6%B6%88%E4%B9%8B%E5%89%8D%E8%BF%98%E6%9C%AA%E8%BF%94%E5%9B%9E%E7%9A%84%E8%AF%B7%E6%B1%82\" aria-label=\"react 离开页面时 axios 取消之前还未返回的请求 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>react 离开页面时 axios 取消之前还未返回的请求</h2>\n\n        <deckgo-highlight-code   terminal=\"carbon\" line-numbers=\"true\" >\n          <code slot=\"code\">import React from &#39;react&#39;\nimport { Route, Switch, withRouter } from &#39;react-router-dom&#39;\nimport axios from &#39;axios&#39;\nimport { Toast } from &#39;antd-mobile&#39;\nimport ReactDOM from &#39;react-dom&#39;\nimport Error from &#39;../components/Error&#39;\n\nimport Home from &#39;../pages/Home&#39;\nimport NoPage from &#39;../pages/404&#39;\nimport Login from &#39;../pages/Login&#39;\n\nclass Interceptors extends React.Component {\n  constructor(props) {\n    super(props)\n    this.errorDom = null\n    this.cancel = null\n  }\n\n\n  componentDidMount() {\n    // 监听路由变化\n    this.props.history.listen(route =&gt; {\n      if (this.cancel) {\n        this.cancel(&quot;取消请求&quot;)\n        Toast.hide()\n      }\n    })\n  }\n\n\n  renderError() {\n    if (this.errorDom) {\n      return\n    }\n    this.errorDom = document.createElement(&#39;div&#39;)\n    ReactDOM.render(\n      &lt;Error reload={() =&gt; {\n        this.errorDom.remove()\n        window.location.reload()\n      }}\n        goBack={() =&gt; {\n          this.errorDom.remove()\n          this.props.history.goBack()\n        }}\n      /&gt;, this.errorDom)\n    document.body.appendChild(this.errorDom)\n  }\n\n  componentWillMount() {\n    let cancelToken = axios.CancelToken\n\t\t/**\n\t \t* 添加请求拦截器\n\t \t*/\n    axios.interceptors.request.use(config =&gt; {\n      this.errorDom &amp;&amp; this.errorDom.remove()\n      config.headers[&#39;token&#39;] = getToken()\n      config.cancelToken = new cancelToken(c =&gt; {\n        this.cancel = c\n      })\n      return config\n    }, error =&gt; {\n      return Promise.reject(error)\n    })\n\n\t\t/**\n\t \t* 添加响应拦截器\n\t \t*/\n    axios.interceptors.response.use(response =&gt; {\n      const { data, msg, success } = response.data\n      if (success === -1) {\n        this.props.history.push(&#39;/login&#39;)\n        return &#39;&#39;\n      }\n      if (success === false) {\n        Toast.info(msg, 2)\n        return Promise.reject(msg)\n      }\n      return data || response.data\n    }, error =&gt; {\n      if (axios.isCancel(error)) {\n        return Promise.reject(error)\n      }\n      Toast.fail(&#39;服务器出错&#39;, 2)\n      this.renderError()\n      return Promise.reject(error)\n    })\n  }\n\n  render() {\n    return (\n      &lt;div&gt;\n        &lt;Switch&gt;\n          &lt;Route path=&#39;/home&#39; component={Home} /&gt;\n          &lt;Route path=&#39;/404&#39; component={NoPage} /&gt;\n          &lt;Route path=&#39;/login&#39; component={Login} /&gt;\n        &lt;/Switch&gt;\n      &lt;/div&gt;\n    )\n  }\n}\n\nexport default withRouter(Interceptors)</code>\n        </deckgo-highlight-code>\n      ","timeToRead":1,"tableOfContents":"<ul>\n<li><a href=\"/myblog/detail/3/#react-%E7%A6%BB%E5%BC%80%E9%A1%B5%E9%9D%A2%E6%97%B6-axios-%E5%8F%96%E6%B6%88%E4%B9%8B%E5%89%8D%E8%BF%98%E6%9C%AA%E8%BF%94%E5%9B%9E%E7%9A%84%E8%AF%B7%E6%B1%82\">react 离开页面时 axios 取消之前还未返回的请求</a></li>\n</ul>","frontmatter":{"date":"2019-04-29","path":"/detail/3","title":"react 离开页面 axios 取消请求","img":"markdown/react 离开页面 axios 取消请求/log.jpg"}}},"pageContext":{}}}